<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/theme/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/theme/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/theme/favicon-16x16.png">
  <link rel="mask-icon" href="/images/theme/avatar.png" color="#222">
  <meta name="google-site-verification" content="N_T7vqtVSFKHn0P1wRhK4gZypoGof-YmIxp-lWIb610">
  <meta name="msvalidate.01" content="1CB8DB019C58E7852A318AAB16B1ABE5">
  <meta name="yandex-verification" content="ce50b7d12f357ffa">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"huntertran.com","root":"/","scheme":"Gemini","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Ở phần trước bạn đã có một khái niệm cơ bản về mô hình MVC. Dựa vào đó, chúng ta sẽ tiếp tục tìm hiểu thêm về database những vấn đề liên quan nhé.">
<meta property="og:type" content="article">
<meta property="og:title" content="[ASP.NET for Beginner] - Part 2 - Connect Database and Model Binding">
<meta property="og:url" content="https://huntertran.com/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/">
<meta property="og:site_name" content="Tuan Tran&#39;s Blog">
<meta property="og:description" content="Ở phần trước bạn đã có một khái niệm cơ bản về mô hình MVC. Dựa vào đó, chúng ta sẽ tiếp tục tìm hiểu thêm về database những vấn đề liên quan nhé.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://farm5.staticflickr.com/4774/38937566770_e203e7c169_o.png">
<meta property="og:image" content="https://farm5.staticflickr.com/4782/40705936652_1e3d6b551d_o.png">
<meta property="og:image" content="https://farm5.staticflickr.com/4779/25877724937_7bfed1c8d7_o.png">
<meta property="article:published_time" content="2018-03-11T16:11:47.000Z">
<meta property="article:modified_time" content="2020-10-04T16:13:45.911Z">
<meta property="article:author" content="Tuan Tran">
<meta property="article:tag" content="core">
<meta property="article:tag" content="database">
<meta property="article:tag" content="entity framework">
<meta property="article:tag" content="model">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://farm5.staticflickr.com/4774/38937566770_e203e7c169_o.png">


<link rel="canonical" href="https://huntertran.com/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[ASP.NET for Beginner] - Part 2 - Connect Database and Model Binding | Tuan Tran's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-174401878-1"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-174401878-1');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Tuan Tran's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Tuan Tran's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Share to be shared</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Lua-chon-database"><span class="nav-text">1. Lựa chọn database</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-SQL-Server"><span class="nav-text">1.1. SQL Server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-The-others"><span class="nav-text">1.2. The others</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Entity-Framework"><span class="nav-text">2. Entity Framework</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-Tao-Model-va-Database"><span class="nav-text">3. Tạo Model và Database</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Tao-model-Phone"><span class="nav-text">3.1. Tạo model Phone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-Tao-Database-Context"><span class="nav-text">3.2. Tạo Database Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-Cai-dat-Connection-String"><span class="nav-text">3.3. Cài đặt Connection String</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-Cai-dat-ket-noi"><span class="nav-text">3.4. Cài đặt kết nối</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-Tao-Migration-dau-tien"><span class="nav-text">3.5. Tạo Migration đầu tiên</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-Model-Binding"><span class="nav-text">4. Model Binding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Tao-Controller"><span class="nav-text">4.1. Tạo Controller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Cac-nuget-can-thiet"><span class="nav-text">4.2. Các nuget cần thiết</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-Scaffolding"><span class="nav-text">4.3. Scaffolding</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-Model-Binding"><span class="nav-text">5. Model Binding</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tuan Tran"
      src="/images/theme/avatar.png">
  <p class="site-author-name" itemprop="name">Tuan Tran</p>
  <div class="site-description" itemprop="description">Programming, technologies, computer tips and life thoughts</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">112</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">209</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/huntetran" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;huntetran" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/huntertrantuan" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;huntertrantuan" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/4506315/tuan-tran" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;4506315&#x2F;tuan-tran" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://huntertran.com/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Tuan Tran">
      <meta itemprop="description" content="Programming, technologies, computer tips and life thoughts">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tuan Tran's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [ASP.NET for Beginner] - Part 2 - Connect Database and Model Binding<a href="https://github.com/huntertran/blog/edit/master/source/_posts/20180311-asp-net-for-beginner-part-2-connect-database-and-model-binding.md" class="post-edit-link" title="Edit this post" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-03-11 12:11:47" itemprop="dateCreated datePublished" datetime="2018-03-11T12:11:47-04:00">2018-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-10-04 12:13:45" itemprop="dateModified" datetime="2020-10-04T12:13:45-04:00">2020-10-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSharp/" itemprop="url" rel="index"><span itemprop="name">CSharp</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSharp/ASP-NET/" itemprop="url" rel="index"><span itemprop="name">ASP.NET</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Ở phần trước bạn đã có một khái niệm cơ bản về mô hình MVC. Dựa vào đó, chúng ta sẽ tiếp tục tìm hiểu thêm về database những vấn đề liên quan nhé.</p>
<a id="more"></a>
<blockquote>
<p>Xem các bài viết trong series</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://coding4food.net/2018/03/04/asp-net-for-beginner-part-1-mvc/">Phần 1: Mô hình MVC</a></li>
<li><a target="_blank" rel="noopener" href="https://coding4food.net/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/">Phần 2: Connect Database và Model Binding</a></li>
<li><a target="_blank" rel="noopener" href="https://coding4food.net/2018/03/18/asp-net-for-beginner-part-3-front-end-framework-nao/">Phần 3: Front end framework nào</a></li>
<li><a target="_blank" rel="noopener" href="https://coding4food.net/2018/03/25/aspnet-for-beginner-part-4-crud-va-data-validation/">Phần 4: CRUD và Data Validation</a></li>
</ul>
</blockquote>
<ul>
<li><p><a href="#1-l%E1%BB%B1a-ch%E1%BB%8Dn-database">1. Lựa chọn database</a></p>
<ul>
<li><a href="#11-sql-server">1.1. SQL Server</a></li>
<li><a href="#12-the-others">1.2. The others</a></li>
</ul>
</li>
<li><p><a href="#2-entity-framework">2. Entity Framework</a></p>
</li>
<li><p><a href="#3-t%E1%BA%A1o-model-v%C3%A0-database">3. Tạo Model và Database</a></p>
<ul>
<li><a href="#31-t%E1%BA%A1o-model-phone">3.1. Tạo model Phone</a></li>
<li><a href="#32-t%E1%BA%A1o-database-context">3.2. Tạo Database Context</a></li>
<li><a href="#33-c%C3%A0i-%C4%91%E1%BA%B7t-connection-string">3.3. Cài đặt Connection String</a></li>
<li><a href="#34-c%C3%A0i-%C4%91%E1%BA%B7t-k%E1%BA%BFt-n%E1%BB%91i">3.4. Cài đặt kết nối</a></li>
<li><a href="#35-t%E1%BA%A1o-migration-%C4%91%E1%BA%A7u-ti%C3%AAn">3.5. Tạo Migration đầu tiên</a></li>
</ul>
</li>
<li><p><a href="#4-model-binding">4. Model Binding</a></p>
<ul>
<li><a href="#41-t%E1%BA%A1o-controller">4.1. Tạo Controller</a></li>
<li><a href="#42-c%C3%A1c-nuget-c%E1%BA%A7n-thi%E1%BA%BFt">4.2. Các nuget cần thiết</a></li>
<li><a href="#43-scaffolding">4.3. Scaffolding</a></li>
</ul>
</li>
<li><p><a href="#5-model-binding">5. Model Binding</a></p>
</li>
</ul>
<p>Có thể hiểu database là trái tim của ứng dụng, còn asp.net là bộ não. Thiết kế một database cho đúng chuẩn thì đòi hỏi kha khá thời gian học + luyện tập thì nó mới lên trình được.</p>
<p>Một cách khác rất hay là bắt tay vào làm một project thực tế. Nếu làm theo phần trước, chắc bạn cũng đã có 1 sample project với tên mvcbasic nhỉ.</p>
<p>Nhìn chung, bạn sẽ có 1 project giống như sau: <a target="_blank" rel="noopener" href="https://github.com/huntertran/mvcbasic/releases/tag/0.1">MVC Basic 0.1 on Github</a></p>
<h1 id="1-Lua-chon-database"><a href="#1-Lua-chon-database" class="headerlink" title="1. Lựa chọn database"></a>1. Lựa chọn database</h1><p>Có hơi bị nhiều hệ quản trị cơ sở dữ liệu đang đấu đá nhau trên thị trường. Ở đây mình sẽ nói sơ qua 1 số loại phổ biến</p>
<h2 id="1-1-SQL-Server"><a href="#1-1-SQL-Server" class="headerlink" title="1.1. SQL Server"></a>1.1. SQL Server</h2><p>Cây nhà là vườn, miễn phí cho người dùng cá nhân, hiệu suất cao, mạnh mẽ, là hệ cơ sở dữ liệu có quan hệ. Sql Server đã chứng minh cho mọi dev thấy tính ổn định của nó.</p>
<h2 id="1-2-The-others"><a href="#1-2-The-others" class="headerlink" title="1.2. The others"></a>1.2. The others</h2><p>Nhìn chung, Microsoft có hỗ trợ kha khá các hệ cơ sở dữ liệu khác như MySQL, PostgreSQL, SQLite, nhưng nếu đã lựa chọn các hệ này, thì bạn sẽ phải tự mày mò kha khá các vấn đề mà đa phần đã được giải quyết khi dùng SQL Server</p>
<h1 id="2-Entity-Framework"><a href="#2-Entity-Framework" class="headerlink" title="2. Entity Framework"></a>2. Entity Framework</h1><p>ASP.NET có một điểm mạnh là Entity Framework (EF). Ở phiên bản core thì nó có thêm EF Core. EF hiểu nôm na là một bộ công cụ cho phép bạn kết nối tới database, truy vấn, thêm xóa sửa vân vân mà không cần phải có kiến thức về cách viết SQL.</p>
<p>Có lợi thì cũng phải có hại, EF theo đánh giá của nhiều người thì nó khá….chậm. Điều này đã và đang được cải thiện rất nhiều ở phiên bản mới đi kèm với ASP.NET Core là Entity Framework Core.</p>
<p>Bạn cần cài đặt</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/sql-server/sql-server-editions-express">SQL Server Express</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms">SQL Server Management Studio</a> (optional)</li>
</ul>
<p>Cài nuget package</p>
<p>Mở project mvcbasic bằng vscode</p>
<p>Lần lượt gõ các lệnh sau trong terminal</p>
<p>[code lang=shell] dotnet add package Microsoft.EntityFrameworkCore.SqlServer dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design [/code]</p>
<p>Sau đó, mở file mvcbasic.csproj và thêm dòng sau</p>
<p>[code lang=xml] <ItemGroup> <DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet" Version="2.0.0" /> </ItemGroup> [/code]</p>
<p>tiếp tục gõ trong terminal</p>
<p>[code lang=text] dotnet restore [/code]</p>
<h1 id="3-Tao-Model-va-Database"><a href="#3-Tao-Model-va-Database" class="headerlink" title="3. Tạo Model và Database"></a>3. Tạo Model và Database</h1><p>Có 2 cách để bắt đầu làm việc với database trong asp.net core là Code first và Database first.</p>
<p>Ngắn gọn thì Code first cho phép bạn viết code trước (tạo các model class), rồi các model bạn tạo sẽ được cập nhật lên database thông qua các <code>migration</code>. Database first thì là cách truyền thống từ xưa tới nay: Tạo database trước, và code của bạn có nghĩa vụ ‘connect’ tới database đó.</p>
<p>Bạn có thể tham khảo thêm ở đây: <a target="_blank" rel="noopener" href="https://coding4food.net/2017/01/06/asp-net-mvc-code-first-vs-database-first/">Code first vs Database first</a></p>
<h2 id="3-1-Tao-model-Phone"><a href="#3-1-Tao-model-Phone" class="headerlink" title="3.1. Tạo model Phone"></a>3.1. Tạo model Phone</h2><p>chuột phải vào folder Models &gt; new file &gt; Phone.cs</p>
<p>[code lang=csharp] namespace mvcbasic.Models { public class Phone { public int Id { get; set; } public string Name { get; set; } } } [/code]</p>
<h2 id="3-2-Tao-Database-Context"><a href="#3-2-Tao-Database-Context" class="headerlink" title="3.2. Tạo Database Context"></a>3.2. Tạo Database Context</h2><p>Database Context có thể hiểu như một công cụ cho phép ứng dụng của bạn kết nối tới Database và thực hiện các tác vụ thêm xóa sửa.</p>
<p>Tạo 1 folder mới ở thư mục gốc với tên ‘Data’</p>
<p>Chuột phải vào folder Data &gt; new file &gt; MvcBasicDbContext.cs</p>
<p>[code lang=csharp] namespace mvcbasic.Data { using Models; using Microsoft.EntityFrameworkCore;</p>
<p>public class MvcBasicDbContext : DbContext { public MvcBasicDbContext(DbContextOptions<MvcBasicDbContext> options) : base(options) { }</p>
<p>public DbSet<Phone> Phones { get; set; } } } [/code]</p>
<h2 id="3-3-Cai-dat-Connection-String"><a href="#3-3-Cai-dat-Connection-String" class="headerlink" title="3.3. Cài đặt Connection String"></a>3.3. Cài đặt Connection String</h2><p>Để kết nối tới database, thì Entity Framework sẽ cần có các thông tin như username, password, tên database, server đang host cái database này. Tất cả thông số đó đều gộp chung lại thành 1 đoạn string, và giang hồ gọi nó là <code>connection string</code></p>
<p>Mở file appsettings.json và thêm vào đoạn json sau</p>
<p>[code lang=json] “ConnectionStrings” : { “PhoneDbConnectionString”: “Server=(localdb)\\mssqllocaldb;Database=PhoneDb;Trusted_Connection=True;” } [/code]</p>
<blockquote>
<p>Đoạn connection string trên có ý nghĩa như sau Server: LocalDb (là một dạng database local có trên các phiên bản mới của SQL Server) Database: PhoneDb Connection tới database dùng Windows Authentication</p>
</blockquote>
<p>Bạn có thể sẽ phải config lại đoạn connection string này cho đúng với môi trường làm việc của bạn</p>
<h2 id="3-4-Cai-dat-ket-noi"><a href="#3-4-Cai-dat-ket-noi" class="headerlink" title="3.4. Cài đặt kết nối"></a>3.4. Cài đặt kết nối</h2><p>Mở file Startup.cs, tìm method <code>ConfigureServices</code> và thêm vào dòng sau</p>
<p>[code lang=csharp] services.AddDbContext<MvcBasicDbContext>(options =&gt; options.UseSqlServer(Configuration.GetConnectionString(“PhoneDbConnectionString”))); [/code]</p>
<p>và nhớ add thêm 2 dòng using</p>
<p>[code lang=csharp] using Microsoft.EntityFrameworkCore; using mvcbasic.Data; [/code]</p>
<h2 id="3-5-Tao-Migration-dau-tien"><a href="#3-5-Tao-Migration-dau-tien" class="headerlink" title="3.5. Tạo Migration đầu tiên"></a>3.5. Tạo Migration đầu tiên</h2><p>Sau khi tất cả các thao tác chuẩn bị đã hoàn tất, đã tới lúc bạn tạo migration đầu tiên của mình</p>
<p>Trong terminal, gõ</p>
<p>[code lang=shell] dotnet ef migrations add InitialCreate [/code]</p>
<p>VSCode sẽ tự động tạo ra một thư mục tên Migrations, và thêm cơ số file vào đấy</p>
<p><a target="_blank" rel="noopener" href="https://farm5.staticflickr.com/4784/40748059781_d2b5740095_o.png">new files</a></p>
<p>Tiếp tục, gõ</p>
<p>[code lang=shell] dotnet ef database update [/code]</p>
<p>thì những migration này sẽ được thực thi, và database sẽ được tạo ra</p>
<p><img src="https://farm5.staticflickr.com/4774/38937566770_e203e7c169_o.png" alt="database created"></p>
<blockquote>
<p>Để kiểm tra, bạn có thể dùng Microsoft SQL Server Management Studio với các thông số sau</p>
<ul>
<li><strong>Server Name</strong>: (LocalDb)\MSSQLLocalDB</li>
<li><strong>Authentication</strong>: Windows Authentication</li>
</ul>
<p>MSSQLLocalDB là tên instance của bạn, có thể khác nếu khi cài SQL Server bạn ko chọn như default</p>
</blockquote>
<h1 id="4-Model-Binding"><a href="#4-Model-Binding" class="headerlink" title="4. Model Binding"></a>4. Model Binding</h1><p>Sau khi hoàn tất các bước trên, cơ bản web app của bạn đã có thể kết nối tới database. Nhưng để thực hiện các hành động thêm xóa sửa, thì bạn cần phải có Controller nữa</p>
<blockquote>
<p>Bạn có thể tải project hoàn tất ở bước 3 tại <a target="_blank" rel="noopener" href="https://github.com/huntertran/mvcbasic/releases/tag/0.2">đây</a></p>
</blockquote>
<h2 id="4-1-Tao-Controller"><a href="#4-1-Tao-Controller" class="headerlink" title="4.1. Tạo Controller"></a>4.1. Tạo Controller</h2><p>VSCode cũng hỗ trợ bạn trong việc tự động tạo ra controller mong muốn mà ko phải code nhiều (thực ra ko phải là VSCode hỗ trợ, mà một công cụ gọi là .NET Cli tools và vài nuget package cho phép bạn làm chuyện này, nhưng trước mắt cứ hiểu vậy đã)</p>
<p>Tên Controller, theo asp.net convention như mình đã nói ở phần 1, sẽ có dạng <code>[Tên]Controller</code>, trong trường hợp này sẽ là <code>PhoneController</code>.</p>
<blockquote>
<p>Một quy tắc đặt tên phổ biến là Tên bảng -&gt; số nhiều: Phones Tên model -&gt; số ít: Phone Tên controller: PhoneController Tên view: Create, Delete, Details, Edit và Index</p>
</blockquote>
<h2 id="4-2-Cac-nuget-can-thiet"><a href="#4-2-Cac-nuget-can-thiet" class="headerlink" title="4.2. Các nuget cần thiết"></a>4.2. Các nuget cần thiết</h2><p>Để có thể tạo controller, bạn sẽ cần thêm một số tool nữa</p>
<p>Mở mvcbasic.csproj và thêm các dòng sau</p>
<p>[code lang=xml] … <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.0.2" /> … <DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="2.0.2" /> … [/code]</p>
<p>Tổng quan, file csproj sẽ giống như sau</p>
<p>[code lang=xml] <Project Sdk="Microsoft.NET.Sdk.Web"></p>
<p><PropertyGroup> <TargetFramework>netcoreapp2.0</TargetFramework> </PropertyGroup></p>
<p><ItemGroup> <PackageReference Include="Microsoft.AspNetCore.All" Version="2.0.5" /> <PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="2.0.1" /> <PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer.Design" Version="1.1.5" /> <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.0.2" /> </ItemGroup></p>
<p><ItemGroup> <DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet" Version="2.0.1" /> <DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="2.0.2" /> </ItemGroup></p>
<p></Project> [/code]</p>
<h2 id="4-3-Scaffolding"><a href="#4-3-Scaffolding" class="headerlink" title="4.3. Scaffolding"></a>4.3. Scaffolding</h2><p>Mở terminal, và gõ lệnh sau</p>
<p>[code lang=shell] dotnet restore dotnet build</p>
<p>dotnet aspnet-codegenerator controller -name PhoneController -m Phone -dc MvcBasicDbContext –relativeFolderPath Controllers –useDefaultLayout –referenceScriptLibraries [/code]</p>
<p>Nhìn vào câu lệnh trên, chắc bạn cũng sẽ đoán được nó làm gì: “Này dotnet, tạo cho tao 1 controller mới tên là <code>PhoneController</code>, dùng model là <code>Phone</code>, Data Context là <code>MvcBasicDbContext</code>, trong folder tên là <code>Controllers</code>, dùng default layout, à có scripts đi kèm nhá”</p>
<p>2 câu lệnh đầu tiên giúp bạn thực sự cài nuget, và build project một phát để đảm bảo ko có lỗi phát sinh, và clear các file tạm ko còn cần thiết</p>
<p><img src="https://farm5.staticflickr.com/4782/40705936652_1e3d6b551d_o.png" alt="create new controller"></p>
<p>gõ tiếp <code>dotnet run</code> để chạy thử app</p>
<p><img src="https://farm5.staticflickr.com/4779/25877724937_7bfed1c8d7_o.png" alt="app with phone controller"></p>
<p>bạn có thể vọc vạch các kiểu với các link mà asp.net core tạo sẵn cho bạn, create new, edit, delete, details gì đấy thì tùy</p>
<h1 id="5-Model-Binding"><a href="#5-Model-Binding" class="headerlink" title="5. Model Binding"></a>5. Model Binding</h1><p>Mở file PhoneController ra, bạn sẽ thấy có sẵn code trong đấy rồi, tuy ko đẹp lắm, nhưng nhìn chung là nó chạy tốt</p>
<p>Hãy nhìn vào method Details</p>
<p>[code lang=csharp] // GET: Phone/Details/5 public async Task<IActionResult> Details(int? id) { if (id == null) { return NotFound(); }</p>
<p>var phone = await _context.Phones .SingleOrDefaultAsync(m =&gt; m.Id == id); if (phone == null) { return NotFound(); }</p>
<p>return View(phone); } [/code]</p>
<p>Method này nhận một tham số là nullable int có tên là id, khi bạn gọi tới url Phone/Details/5 (như dòng comment ở bên trên), thì số 5 đó sẽ được hiểu là Id. Đó chính là model binding</p>
<p>Tiếp tục, nhìn vào class Create có attribute <code>[HttpPost]</code></p>
<p>[code lang=csharp] // POST: Phone/Create // To protect from overposting attacks, please enable the specific properties you want to bind to, for // more details see <a target="_blank" rel="noopener" href="http://go.microsoft.com/fwlink/?LinkId=317598">http://go.microsoft.com/fwlink/?LinkId=317598</a>. [HttpPost] [ValidateAntiForgeryToken] public async Task<IActionResult> Create([Bind(“Id,Name”)] Phone phone) { if (ModelState.IsValid) { _context.Add(phone); await _context.SaveChangesAsync(); return RedirectToAction(nameof(Index)); } return View(phone); } [/code]</p>
<p>Model binding còn vi diệu ở chỗ, nếu bạn dùng hẳn 1 class làm parameter, thì ASP.NET sẽ tự hiểu các property trong class đó, và gắn đúng từng giá trị một</p>
<p>Bạn có thể xóa <code>[Bind(&quot;Id,Name&quot;)]</code> đi và code vẫn chạy tốt, nhưng như Microsoft đã cảnh báo, để bảo vệ bạn khỏi chuyện orver posting attack, thì bạn phải chỉ định luôn là property nào sẽ được gắn</p>
<p>Method này tương ứng với Views &gt; Phone &gt; Create.cshtml</p>
<p>[code lang=html] <!--dòng 17--> <input asp-for="Name" class="form-control" /> [/code]</p>
<p>từ khóa <code>asp-for</code> thông báo rằng Name là property sẽ được truyền lên server, và server sẽ “gắn” nó vào model phone của method Create</p>
<blockquote>
<p>Tại sao lại ko có Id? Vì Id mặc định được coi như Key của bảng Phone, và key thì ko cần phải có khi tạo mới, vì database sẽ tự sinh ra nó</p>
</blockquote>
<p>Tiếp tục, mở Views &gt; Phone &gt; Index.cshtml bạn sẽ thấy đoạn code sau</p>
<p>[code lang=csharp] @foreach (var item in Model) { <tr> <td> @Html.DisplayFor(modelItem =&gt; item.Name) </td> <td> <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> | <a asp-action="Details" asp-route-id="@item.Id">Details</a> | <a asp-action="Delete" asp-route-id="@item.Id">Delete</a> </td> </tr> } [/code]</p>
<blockquote>
<p>ô lạ chưa, có foreach trong html Ngôn ngữ này gọi là Razor, cho phép bạn thực thi một số đoạn code C# trong html, giúp cho việc render ra các tag html như mong muốn.</p>
</blockquote>
<p>Razor thông minh tới mức nó tự hiểu chỗ nào là code html, và chỗ nào là code Razor, với các nguyên tắc vô cùng đơn giản</p>
<ul>
<li>Mỗi đoạn code razor đều bắt đầu bằng dấu <code>@</code></li>
<li>Ngay sau dấu <code>&#123;</code> hoặc <code>(</code> thì ko cần <code>@</code></li>
</ul>
<p>Database và Model binding còn nhiều điều để nói. Tạm thời ta cứ hiểu vậy đã</p>
<p>Đón đọc phần 3 bạn nhé :)</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/theme/paypal.png" alt="Tuan Tran PayPal">
        <span>PayPal</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Tuan Tran
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://huntertran.com/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/" title="[ASP.NET for Beginner] - Part 2 - Connect Database and Model Binding">https://huntertran.com/2018/03/11/asp-net-for-beginner-part-2-connect-database-and-model-binding/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          

  <div class="followme">
    <span>Welcome to my other publishing channels</span>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/huntertrantuan">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>

          <div class="post-tags">
              <a href="/tags/core/" rel="tag"># core</a>
              <a href="/tags/database/" rel="tag"># database</a>
              <a href="/tags/entity-framework/" rel="tag"># entity framework</a>
              <a href="/tags/model/" rel="tag"># model</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/03/04/asp-net-for-beginner-part-1-mvc/" rel="prev" title="[ASP.NET for Beginner] - Part 1 - MVC">
                  <i class="fa fa-chevron-left"></i> [ASP.NET for Beginner] - Part 1 - MVC
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/03/18/asp-net-for-beginner-part-3-front-end-framework-nao/" rel="next" title="[ASP.NET for Beginner] - Part 3 - Front end framework nào?">
                  [ASP.NET for Beginner] - Part 3 - Front end framework nào? <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2011 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tuan Tran</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  




  <script src="/js/local-search.js"></script>












  








    <div class="pjax">
  

  

    </div>
</body>
</html>
