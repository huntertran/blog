<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>[ASP.NET Core] Auto Anti-forgery Token | Tuan Tran's Blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/blog/atom.xml" title="Tuan Tran's Blog" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/blog/plugins/prettify/doxy.css"><script type="text/javascript" src="/blog/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">Tuan Tran's Blog</a></h1></div><p class="m-desc">Share to be shared</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/blog/archives/">Archives</a></li><li><span class="dot">●</span><a href="/blog/categories/">Categories</a></li><li><span class="dot">●</span><a href="/blog/tags/">Tags</a></li><li><span class="dot">●</span><a href="/blog/about/">About</a></li><li><span class="dot">●</span><a href="/blog/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="Search for" onfocus="if(this.value=='Search for'){this.value='';}" onblur="if(this.value==''){this.value='Search for';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">[ASP.NET Core] Auto Anti-forgery Token</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/blog/2018/03/03/asp-net-core-auto-anti-forgery-token/">2018-03-03</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/blog/categories/c/">c</a>&nbsp;&bull;&nbsp;<a href="/blog/categories/c/ASP-NET/">ASP.NET</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><p>Có một cách giúp bạn tự động áp dụng <code>ValidateAntiForgeryToken</code> vào tất cả các Post Action trong controller của mình</p>
<a id="more"></a>
<p>Chắc bạn đã từng nghe qua <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross-site Request Forgery (CSRF) attacks</a>. Hiểu một cách đơn giản là Server thực thi một request giả mạo xuất phát từ hacker, nhưng với chứng thực xịn của 1 user nào đó. Điều này rất dễ thực hiện. Giả sử bạn truy cập 1 forum nào đó, trong đó có chứa đoạn javascript giả mạo 1 request tới ngân hàng của bạn, yêu cầu chuyển tiền. Nếu bạn vẫn đang đăng nhập vào tài khoản ebanking của mình, và ngân hàng ko áp dụng bất kỳ phương pháp bảo vệ nào, thì như một cái búng tay, tiền của bạn đã chuyển vào túi hacker.</p>
<p>ASP.NET đã implement sẵn cho bạn cách để chống lại phương thức tấn công này, và họ gọi nó là <em><code>Anti-forgery Token</code></em></p>
<h1 id="Default-protection-with-ASP-NET-Core-2"><a href="#Default-protection-with-ASP-NET-Core-2" class="headerlink" title="Default protection with ASP.NET Core 2"></a>Default protection with ASP.NET Core 2</h1><p>Với ASP.NET Core 2, mỗi khi bạn dùng <code>form</code> tag, asp.net sẽ tự động chèn anti-forgery token cho bạn</p>
<blockquote>
<p>Với điều kiện: <code>form</code> tag có attribute <code>method=&quot;post&quot;</code> VÀ * attribute <code>action</code> không có data: <code>action=&quot;&quot;</code> HOẶC * attribute <code>action</code> không có</p>
</blockquote>
<p>Tiếp tục, bạn phải thêm attribute <code>[ValidateAntiForgeryToken]</code> và action nhận data post lên</p>
<p>[code lang=csharp] [HttpPost] [ValidateAntiForgeryToken] public async Task<IActionResult> RemoveLogin(RemoveLoginViewModel account) { // Do something here } [/code]</p>
<h1 id="Auto-protection-with-ASP-NET-Core-2"><a href="#Auto-protection-with-ASP-NET-Core-2" class="headerlink" title="Auto protection with ASP.NET Core 2"></a>Auto protection with ASP.NET Core 2</h1><p>Ở cách trên, với mỗi Action nhận Post request, bạn đều phải thêm [ValidationAntiForgeryToken] thủ công</p>
<p>Asp.net Core giới thiệu 1 class mới, giúp bạn tự động hóa quá trình này</p>
<h2 id="Neu-ban-muon-tu-dong-cho-tung-Controller"><a href="#Neu-ban-muon-tu-dong-cho-tung-Controller" class="headerlink" title="Nếu bạn muốn tự động cho từng Controller"></a>Nếu bạn muốn tự động cho từng Controller</h2><p>[code lang=csharp] [Authorize] [AutoValidateAntiforgeryToken] public class ManageController : Controller { // Your code here } [/code]</p>
<h2 id="Neu-ban-muon-ap-dung-cho-toan-bo-app"><a href="#Neu-ban-muon-ap-dung-cho-toan-bo-app" class="headerlink" title="Nếu bạn muốn áp dụng cho toàn bộ app"></a>Nếu bạn muốn áp dụng cho toàn bộ app</h2><p>[code lang=csharp] public class Startup { public void ConfigureServices(IServiceCollection services) { services.AddMvc(options =&gt; { options.Filters.Add(new AutoValidateAntiforgeryTokenAttribute()); }); } } [/code]</p>
<p>Vậy là xong</p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">Author：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">Tuan Tran</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">Link to this article：</span><span class="p-copytight-value"><a href="/blog/2018/03/03/asp-net-core-auto-anti-forgery-token/">https://huntertran.github.io/blog/2018/03/03/asp-net-core-auto-anti-forgery-token/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">Copyright：</span><span class="p-copytight-value">All rights reserved with<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>agreement. Include the source <a href="https://huntertran.github.io/blog">Tuan Tran's blog</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tags"></i><a href="/blog/tags/attack/">attack</a><a href="/blog/tags/cross-site/">cross-site</a><a href="/blog/tags/forgery/">forgery</a><a href="/blog/tags/forgery-token/">forgery token</a><a href="/blog/tags/request/">request</a></span></div><aside id="toc"><div class="toc-title">Table of Contents</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Default-protection-with-ASP-NET-Core-2"><span class="toc-number">1.</span> <span class="toc-text">Default protection with ASP.NET Core 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auto-protection-with-ASP-NET-Core-2"><span class="toc-number">2.</span> <span class="toc-text">Auto protection with ASP.NET Core 2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Neu-ban-muon-tu-dong-cho-tung-Controller"><span class="toc-number">2.1.</span> <span class="toc-text">Nếu bạn muốn tự động cho từng Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Neu-ban-muon-ap-dung-cho-toan-bo-app"><span class="toc-number">2.2.</span> <span class="toc-text">Nếu bạn muốn áp dụng cho toàn bộ app</span></a></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/blog/2018/03/03/asp-net-core-razor-page-lets-think-straight/">&lt; [ASP.NET Core] - Razor Page - Let's think straight</a><a class="next" href="/blog/2018/02/17/moving-to-open-source-softwares/">Moving to open source softwares &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'en',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2020 <a href="/blog/." rel="nofollow">Tuan Tran's Blog</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/blog/plugins/prettify/prettify.js"></script><script type="text/javascript" src="/blog/js/search.js"></script><script type="text/javascript" src="/blog/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.1" async></script></body></html>