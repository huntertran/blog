<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/theme/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/theme/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/theme/favicon-16x16.png">
  <link rel="mask-icon" href="/images/theme/avatar.png" color="#222">
  <meta name="google-site-verification" content="N_T7vqtVSFKHn0P1wRhK4gZypoGof-YmIxp-lWIb610">
  <meta name="msvalidate.01" content="1CB8DB019C58E7852A318AAB16B1ABE5">
  <meta name="yandex-verification" content="ce50b7d12f357ffa">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"huntertran.com","root":"/","scheme":"Gemini","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="Tưởng tượng bạn có list các item trong ViewModel Nếu bạn muốn cho phép user thêm mới 1 item, hoặc edit bất kỳ item nào trong list thì làm sao? Đọc xong bài này, bạn sẽ biết cách làm nhóe">
<meta property="og:type" content="article">
<meta property="og:title" content="[ASPNET] Editor for với List và thêm mới item dùng AJAX">
<meta property="og:url" content="https://huntertran.com/2017/04/25/aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax/">
<meta property="og:site_name" content="Tuan Tran&#39;s Blog">
<meta property="og:description" content="Tưởng tượng bạn có list các item trong ViewModel Nếu bạn muốn cho phép user thêm mới 1 item, hoặc edit bất kỳ item nào trong list thì làm sao? Đọc xong bài này, bạn sẽ biết cách làm nhóe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://farm5.staticflickr.com/4169/34124808091_f4c2130fd2_o.png">
<meta property="article:published_time" content="2017-04-25T07:32:39.000Z">
<meta property="article:modified_time" content="2020-10-05T15:59:56.209Z">
<meta property="article:author" content="Tuan Tran">
<meta property="article:tag" content="editorfor">
<meta property="article:tag" content="ajax">
<meta property="article:tag" content="editorformany">
<meta property="article:tag" content="list">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://farm5.staticflickr.com/4169/34124808091_f4c2130fd2_o.png">


<link rel="canonical" href="https://huntertran.com/2017/04/25/aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[ASPNET] Editor for với List và thêm mới item dùng AJAX | Tuan Tran's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-174401878-1"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-174401878-1');
      }
    </script>






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Tuan Tran's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Tuan Tran's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Share to be shared</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-EditorFor-Control"><span class="nav-text">1. EditorFor Control</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Class"><span class="nav-text">2. Class</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-C-code"><span class="nav-text">2.1. C# code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-JavaScript-Code"><span class="nav-text">2.2. JavaScript Code</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-Cach-xai"><span class="nav-text">3. Cách xài</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Chuan-bi-model"><span class="nav-text">3.1. Chuẩn bị model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-Razor-code"><span class="nav-text">3.2. Razor code</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-Ket-qua"><span class="nav-text">4. Kết quả</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-Cach-hoat-dong"><span class="nav-text">5. Cách hoạt động</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Cac-buoc"><span class="nav-text">5.1. Các bước</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Tai-sao-lai-can-Index"><span class="nav-text">5.2. Tại sao lại cần Index</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tuan Tran"
      src="/images/theme/avatar.png">
  <p class="site-author-name" itemprop="name">Tuan Tran</p>
  <div class="site-description" itemprop="description">Programming, technologies, computer tips and life thoughts</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">112</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">209</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/huntetran" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;huntetran" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/huntertrantuan" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;huntertrantuan" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/4506315/tuan-tran" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;4506315&#x2F;tuan-tran" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://huntertran.com/2017/04/25/aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Tuan Tran">
      <meta itemprop="description" content="Programming, technologies, computer tips and life thoughts">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tuan Tran's Blog">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [ASPNET] Editor for với List và thêm mới item dùng AJAX<a href="https://github.com/huntertran/blog/edit/master/source/_posts/20170425-aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax.md" class="post-edit-link" title="Edit this post" rel="noopener" target="_blank"><i class="fa fa-pen-nib"></i></a>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-04-25 03:32:39" itemprop="dateCreated datePublished" datetime="2017-04-25T03:32:39-04:00">2017-04-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-10-05 11:59:56" itemprop="dateModified" datetime="2020-10-05T11:59:56-04:00">2020-10-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSharp/" itemprop="url" rel="index"><span itemprop="name">CSharp</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSharp/ASP-NET/" itemprop="url" rel="index"><span itemprop="name">ASP.NET</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Tưởng tượng bạn có list các item trong ViewModel</p>
<p>Nếu bạn muốn cho phép user thêm mới 1 item, hoặc edit bất kỳ item nào trong list thì làm sao?</p>
<p>Đọc xong bài này, bạn sẽ biết cách làm nhóe</p>
<a id="more"></a>

<!-- TOC -->

<ul>
<li><a href="#1-editorfor-control">1. EditorFor Control</a></li>
<li><a href="#2-class">2. Class</a><ul>
<li><a href="#21-c-code">2.1. C# code</a></li>
<li><a href="#22-javascript-code">2.2. JavaScript Code</a></li>
</ul>
</li>
<li><a href="#3-c%C3%A1ch-x%C3%A0i">3. Cách xài</a><ul>
<li><a href="#31-chu%E1%BA%A9n-b%E1%BB%8B-model">3.1. Chuẩn bị model</a></li>
<li><a href="#32-razor-code">3.2. Razor code</a></li>
</ul>
</li>
<li><a href="#4-k%E1%BA%BFt-qu%E1%BA%A3">4. Kết quả</a></li>
<li><a href="#5-c%C3%A1ch-ho%E1%BA%A1t-%C4%91%E1%BB%99ng">5. Cách hoạt động</a><ul>
<li><a href="#51-c%C3%A1c-b%C6%B0%E1%BB%9Bc">5.1. Các bước</a></li>
<li><a href="#52-t%E1%BA%A1i-sao-l%E1%BA%A1i-c%E1%BA%A7n-index">5.2. Tại sao lại cần Index</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->

<h1 id="1-EditorFor-Control"><a href="#1-EditorFor-Control" class="headerlink" title="1. EditorFor Control"></a>1. EditorFor Control</h1><p><a id="markdown-editorfor-control" name="editorfor-control"></a></p>
<p>Trong <a target="_blank" rel="noopener" href="https://coding4food.net/2017/04/20/asp-net-mo-rong-editorfor/">bài kỳ trước</a>, bạn đã biết cách xài EditorFor và EditorForModel control.</p>
<p>Một điểm hạn chế của 2 thằng này là chúng không tạo ra input cho các class tùy biến của bạn</p>
<p>Còn 1 list các item thì lại càng không có.</p>
<p>Hiển thị một list thì dễ, một vòng lặp for (hoặc foreach) là xong</p>
<p>Nhưng một “Editor” cho cả một list thì ko được support, nên bạn phải tự tạo thôi</p>
<p>Từ một bài viết thú vị từ Matt Lunn <a target="_blank" rel="noopener" href="https://www.mattlunn.me.uk/blog/2014/08/how-to-dynamically-via-ajax-add-new-items-to-a-bound-list-model-in-asp-mvc-net/">ở đây</a>, chúng ta sẽ thay đổi một tí cho dễ xài và phù hợp với yêu cầu hơn nhóe</p>
<h1 id="2-Class"><a href="#2-Class" class="headerlink" title="2. Class"></a>2. Class</h1><p><a id="markdown-class" name="class"></a></p>
<h2 id="2-1-C-code"><a href="#2-1-C-code" class="headerlink" title="2.1. C# code"></a>2.1. C# code</h2><p><a id="markdown-c%23-code" name="c%23-code"></a></p>
<pre class="line-numbers language-cs" data-language="cs"><code class="language-cs"><span class="token keyword">namespace</span> <span class="token namespace">Yournamespace<span class="token punctuation">.</span>Utilities</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq<span class="token punctuation">.</span>Expressions</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc<span class="token punctuation">.</span>Html</span><span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HtmlHelperExtensions</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">/// &lt;summary></span>
        <span class="token comment">/// Generate appropriate control for a list of data</span>
        <span class="token comment">/// &lt;/summary></span>
        <span class="token comment">/// &lt;typeparam name="TModel">The Model contain the list&lt;/typeparam></span>
        <span class="token comment">/// &lt;typeparam name="TValue">The Model of list of items&lt;/typeparam></span>
        <span class="token comment">/// &lt;param name="html">&lt;/param></span>
        <span class="token comment">/// &lt;param name="propertyExpression">Which property&lt;/param></span>
        <span class="token comment">/// &lt;param name="indexResolverExpression">Select the property to be the index&lt;/param></span>
        <span class="token comment">/// &lt;param name="isIncludeNewItem">Set to true to include a default new item&lt;/param></span>
        <span class="token comment">/// &lt;param name="includeIndexField">Set to true to include Index in values sent to server&lt;/param></span>
        <span class="token comment">/// &lt;returns>HTML codes of editorfor a list of items&lt;/returns></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">MvcHtmlString</span> <span class="token generic-method"><span class="token function">EditorForMany</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> TValue<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>
            <span class="token keyword">this</span> <span class="token class-name">HtmlHelper<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">></span></span> html<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">></span><span class="token punctuation">></span><span class="token punctuation">></span></span> propertyExpression<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> indexResolverExpression <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> isIncludeNewItem <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> includeIndexField <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">TModel</span> 
                <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span> <span class="token keyword">where</span> <span class="token class-name">TValue</span> 
                <span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> items <span class="token operator">=</span> propertyExpression<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>ViewData<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> htmlBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> htmlFieldName <span class="token operator">=</span> ExpressionHelper<span class="token punctuation">.</span><span class="token function">GetExpressionText</span><span class="token punctuation">(</span>propertyExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> htmlFieldNameWithPrefix <span class="token operator">=</span> html<span class="token punctuation">.</span>ViewData<span class="token punctuation">.</span>TemplateInfo<span class="token punctuation">.</span><span class="token function">GetFullHtmlFieldName</span><span class="token punctuation">(</span>htmlFieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> indexResolver <span class="token operator">=</span> <span class="token function">GetIndexResolver</span><span class="token punctuation">(</span>indexResolverExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
            items <span class="token operator">=</span> <span class="token function">AddDefaultNewItem</span><span class="token punctuation">(</span>isIncludeNewItem<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> items<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> dummy <span class="token operator">=</span> <span class="token keyword">new</span>
                <span class="token punctuation">&#123;</span>
                    Item <span class="token operator">=</span> item
                <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
 
                <span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> <span class="token function">indexResolver</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token class-name"><span class="token keyword">var</span></span> memberExp <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token function">MakeMemberAccess</span><span class="token punctuation">(</span>
                    Expression<span class="token punctuation">.</span><span class="token function">Constant</span><span class="token punctuation">(</span>dummy<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dummy<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">"Item"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                <span class="token class-name"><span class="token keyword">var</span></span> singleItemExp <span class="token operator">=</span> Expression<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Lambda</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> TValue<span class="token punctuation">></span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span>memberExp<span class="token punctuation">,</span> propertyExpression<span class="token punctuation">.</span>Parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
                guid <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>guid<span class="token punctuation">)</span> <span class="token punctuation">?</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> html<span class="token punctuation">.</span><span class="token function">AttributeEncode</span><span class="token punctuation">(</span>guid<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">BuildHtmlString</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> indexResolverExpression<span class="token punctuation">,</span> includeIndexField<span class="token punctuation">,</span> htmlBuilder<span class="token punctuation">,</span> htmlFieldName<span class="token punctuation">,</span> htmlFieldNameWithPrefix<span class="token punctuation">,</span> guid<span class="token punctuation">,</span> singleItemExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MvcHtmlString</span><span class="token punctuation">(</span>htmlBuilder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">BuildHtmlString</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> TValue<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>
            <span class="token class-name">HtmlHelper<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">></span></span> html<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> indexResolverExpression<span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">bool</span></span> includeIndexField<span class="token punctuation">,</span>
            <span class="token class-name">StringBuilder</span> htmlBuilder<span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">string</span></span> htmlFieldName<span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">string</span></span> htmlFieldNameWithPrefix<span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">string</span></span> guid<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> TValue<span class="token punctuation">></span><span class="token punctuation">></span></span> singleItemExp<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">TModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
            <span class="token keyword">where</span> <span class="token class-name">TValue</span> <span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            htmlBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">@"&lt;div>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>includeIndexField<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                htmlBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token function">_EditorForManyIndexField</span><span class="token punctuation">(</span>htmlFieldNameWithPrefix<span class="token punctuation">,</span> guid<span class="token punctuation">,</span> indexResolverExpression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            htmlBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span><span class="token function">EditorFor</span><span class="token punctuation">(</span>singleItemExp<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">htmlFieldName</span><span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">guid</span><span class="token punctuation">&#125;</span></span><span class="token string">]"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            htmlBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">@"&lt;/div>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">></span></span> <span class="token generic-method"><span class="token function">AddDefaultNewItem</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TValue<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> isIncludeNewItem<span class="token punctuation">,</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">></span></span> items<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">TValue</span> <span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isIncludeNewItem<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                items <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">Concat</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            <span class="token keyword">return</span> items<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> <span class="token generic-method"><span class="token function">GetIndexResolver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TValue<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> indexResolverExpression<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">TValue</span> <span class="token punctuation">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token class-name">Func<span class="token punctuation">&lt;</span>TValue<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> indexResolver<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>indexResolverExpression <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                indexResolver <span class="token operator">=</span> x <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
                indexResolver <span class="token operator">=</span> indexResolverExpression<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            <span class="token keyword">return</span> indexResolver<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">MvcHtmlString</span> <span class="token generic-method"><span class="token function">EditorForManyIndexField</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TModel<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>
            <span class="token keyword">this</span> <span class="token class-name">HtmlHelper<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">></span></span> html<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> indexResolverExpression <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> htmlPrefix <span class="token operator">=</span> html<span class="token punctuation">.</span>ViewData<span class="token punctuation">.</span>TemplateInfo<span class="token punctuation">.</span>HtmlFieldPrefix<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> first <span class="token operator">=</span> htmlPrefix<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token string character">'['</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> last <span class="token operator">=</span> htmlPrefix<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string character">']'</span><span class="token punctuation">,</span> first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> last <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">"EditorForManyIndexField called when not in a EditorForMany context"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            <span class="token class-name"><span class="token keyword">var</span></span> htmlFieldNameWithPrefix <span class="token operator">=</span> htmlPrefix<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> guid <span class="token operator">=</span> htmlPrefix<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> last <span class="token operator">-</span> first <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">return</span> <span class="token function">_EditorForManyIndexField</span><span class="token punctuation">(</span>htmlFieldNameWithPrefix<span class="token punctuation">,</span> guid<span class="token punctuation">,</span> indexResolverExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">MvcHtmlString</span> <span class="token generic-method"><span class="token function">_EditorForManyIndexField</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TModel<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>
            <span class="token class-name"><span class="token keyword">string</span></span> htmlFieldNameWithPrefix<span class="token punctuation">,</span>
            <span class="token class-name"><span class="token keyword">string</span></span> guid<span class="token punctuation">,</span>
            <span class="token class-name">Expression<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>TModel<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span><span class="token punctuation">></span></span> indexResolverExpression<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> htmlBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            htmlBuilder<span class="token punctuation">.</span><span class="token function">AppendFormat</span><span class="token punctuation">(</span>
                <span class="token string">@"&lt;input type=""hidden"" name=""&#123;0&#125;.Index"" value=""&#123;1&#125;"" />"</span><span class="token punctuation">,</span>
                htmlFieldNameWithPrefix<span class="token punctuation">,</span>
                guid<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>indexResolverExpression <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                htmlBuilder<span class="token punctuation">.</span><span class="token function">AppendFormat</span><span class="token punctuation">(</span>
                    <span class="token string">@"&lt;input type=""hidden"" name=""&#123;0&#125;[&#123;1&#125;].&#123;2&#125;"" value=""&#123;1&#125;"" />"</span><span class="token punctuation">,</span>
                    htmlFieldNameWithPrefix<span class="token punctuation">,</span>
                    guid<span class="token punctuation">,</span>
                    ExpressionHelper<span class="token punctuation">.</span><span class="token function">GetExpressionText</span><span class="token punctuation">(</span>indexResolverExpression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
 
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MvcHtmlString</span><span class="token punctuation">(</span>htmlBuilder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-JavaScript-Code"><a href="#2-2-JavaScript-Code" class="headerlink" title="2.2. JavaScript Code"></a>2.2. JavaScript Code</h2><p><a id="markdown-javascript-code" name="javascript-code"></a></p>
<p>Đoạn code dưới dây dùng JQuery, nhưng bạn có thể convert nó sang JavaScript thuần cũng vẫn được nhóe</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">GenerateGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x10000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
 
    <span class="token keyword">return</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">s4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 
<span class="token keyword">function</span> <span class="token function">AssignAddMoreButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".add-more-button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">debugger</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">"#"</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> clone <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> guid <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>guid<span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> newHtml <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> oldHtml</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> oldHtml<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regex<span class="token punctuation">,</span> <span class="token function">GenerateGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>newHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="3-Cach-xai"><a href="#3-Cach-xai" class="headerlink" title="3. Cách xài"></a>3. Cách xài</h1><p><a id="markdown-c%C3%A1ch-x%C3%A0i" name="c%C3%A1ch-x%C3%A0i"></a></p>
<h2 id="3-1-Chuan-bi-model"><a href="#3-1-Chuan-bi-model" class="headerlink" title="3.1. Chuẩn bị model"></a>3.1. Chuẩn bị model</h2><p><a id="markdown-chu%E1%BA%A9n-b%E1%BB%8B-model" name="chu%E1%BA%A9n-b%E1%BB%8B-model"></a></p>
<p>Cái model mà bạn muốn dùng với cái control EditorForMany này, bạn phải thêm một property là Index vô nữa</p>
<p>Ví dụ, nếu tui có một cái class tên là Model luôn</p>
<pre class="line-numbers language-cs" data-language="cs"><code class="language-cs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// Your normal, already existed properties</span>
 
    <span class="token comment">// set to false if you don't want to generate a HTML input tag</span>
    <span class="token comment">// for it when using with editorfor control</span>
    <span class="token punctuation">[</span><span class="token function">ScaffoldColumn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Index <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-2-Razor-code"><a href="#3-2-Razor-code" class="headerlink" title="3.2. Razor code"></a>3.2. Razor code</h2><p><a id="markdown-razor-code" name="razor-code"></a></p>
<pre class="line-numbers language-cs" data-language="cs"><code class="language-cs">@<span class="token keyword">using</span><span class="token punctuation">(</span>Html<span class="token punctuation">.</span><span class="token function">BeginForm</span><span class="token punctuation">(</span><span class="token string">"ActionName"</span><span class="token punctuation">,</span><span class="token string">"ControllerName"</span><span class="token punctuation">,</span>FormMethod<span class="token punctuation">.</span>Post<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">&#123;</span>@<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"CssClassName"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// the last parameter "true" is to generate a default item</span>
    @Html<span class="token punctuation">.</span><span class="token function">EditorForMany</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> x <span class="token operator">=></span> x<span class="token punctuation">.</span>Index<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
 
 
    <span class="token comment">// include the javascript code file above</span>
    <span class="token function">AssignAddMoreButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Nếu bạn muốn đặt toàn bộ code javascript vào một file .js, nhớ gọi function AssignAddMoreButton sau khi “document ready” nhóe</p>
<h1 id="4-Ket-qua"><a href="#4-Ket-qua" class="headerlink" title="4. Kết quả"></a>4. Kết quả</h1><p><a id="markdown-k%E1%BA%BFt-qu%E1%BA%A3" name="k%E1%BA%BFt-qu%E1%BA%A3"></a></p>
<p>Kết quả nó sẽ giống vầy (có thêm style của bootstrap nữa nha) <img src="https://farm5.staticflickr.com/4169/34124808091_f4c2130fd2_o.png" alt="demo image"></p>
<h1 id="5-Cach-hoat-dong"><a href="#5-Cach-hoat-dong" class="headerlink" title="5. Cách hoạt động"></a>5. Cách hoạt động</h1><p><a id="markdown-c%C3%A1ch-ho%E1%BA%A1t-%C4%91%E1%BB%99ng" name="c%C3%A1ch-ho%E1%BA%A1t-%C4%91%E1%BB%99ng"></a></p>
<p>HtmlHelperExtensions chính là chỗ mà điều kỳ diệu xảy ra. Keyword Extensions sẽ “đăng ký” nó thành một extension của HtmlHelper</p>
<h2 id="5-1-Cac-buoc"><a href="#5-1-Cac-buoc" class="headerlink" title="5.1. Các bước"></a>5.1. Các bước</h2><p><a id="markdown-c%C3%A1c-b%C6%B0%E1%BB%9Bc" name="c%C3%A1c-b%C6%B0%E1%BB%9Bc"></a></p>
<p>Về cơ bản, nó sẽ làm những bước sau</p>
<ol>
<li>Lấy danh sách Items</li>
<li>Lấy Index property (nếu bạn có khai báo index)</li>
<li>Generate một item default mới (nếu bạn kêu nó làm thế)</li>
<li>Dựng code HTML</li>
</ol>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- List of your html input tag generated by editorfor and extended templates --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="5-2-Tai-sao-lai-can-Index"><a href="#5-2-Tai-sao-lai-can-Index" class="headerlink" title="5.2. Tại sao lại cần Index"></a>5.2. Tại sao lại cần Index</h2><p><a id="markdown-t%E1%BA%A1i-sao-l%E1%BA%A1i-c%E1%BA%A7n-index" name="t%E1%BA%A1i-sao-l%E1%BA%A1i-c%E1%BA%A7n-index"></a></p>
<p>Có 2 cách để send một list data tới controller</p>
<ul>
<li><p>dùng một mảng có đánh số</p>
<ul>
<li>xóa 1 item sẽ làm lộn xộn cả list, controller chỉ nhận mảng liên tục</li>
<li>thêm mới 1 item thì cần phải biết index cuối cùng là bao nhiêu</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList[0].Data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList[1].Data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>dùng mảng có index dạng string<ul>
<li>yêu cầu thêm một tag input ẩn để chứa index</li>
<li>dễ thêm, xóa, sửa item</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList.Index<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radomGuid1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList[randomGuid1].Data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList.Index<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>anotherGuid2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>YourList[anotherGuid2].Data<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Như bạn cũng thấy, giá trị của hidden input tag có thể là bất cứ gì, miễn là giá trị trong ngoặc vuông giống với nó.</p>
<p>Bước 1 bước xa hơn, đoạn code javascript bên trên sẽ tạo ra index dạng GUID, cho nên bạn sẽ không phải lo về vấn đề trùng lặp index. Tuy nhiên, nó ko phải là GUID thiệt, vì để generate GUID thiệt sẽ hơi phức tạp, và làm cho app nặng lên, giống như xài tên lửa đi giết ruồi, cho nên để cho đơn giản, đoạn code đó chỉ sinh ra “fake” GUID, nhưng theo cách code thì khó mà trùng được</p>
<p>Theo bạn, bạn có cách nào cải tiến đoạn code bên trên không?</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/theme/paypal.png" alt="Tuan Tran PayPal">
        <span>PayPal</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Tuan Tran
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://huntertran.com/2017/04/25/aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax/" title="[ASPNET] Editor for với List và thêm mới item dùng AJAX">https://huntertran.com/2017/04/25/aspnet-editor-for-voi-list-va-them-moi-item-dung-ajax/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          

  <div class="followme">
    <span>Welcome to my other publishing channels</span>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/huntertrantuan">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>

          <div class="post-tags">
              <a href="/tags/editorfor/" rel="tag"># editorfor</a>
              <a href="/tags/ajax/" rel="tag"># ajax</a>
              <a href="/tags/editorformany/" rel="tag"># editorformany</a>
              <a href="/tags/list/" rel="tag"># list</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/04/20/asp-net-mo-rong-editorfor/" rel="prev" title="[ASP.NET] Mở rộng EditorFor">
                  <i class="fa fa-chevron-left"></i> [ASP.NET] Mở rộng EditorFor
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/08/02/wordpress-install-wordpress-to-docker-containers-from-windows/" rel="next" title="Wordpress - Install Wordpress to Docker containers from Windows">
                  Wordpress - Install Wordpress to Docker containers from Windows <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2011 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tuan Tran</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  




  <script src="/js/local-search.js"></script>












  








    <div class="pjax">
  

  

    </div>
</body>
</html>
