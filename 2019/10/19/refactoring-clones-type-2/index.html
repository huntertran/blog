<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>[java] Refactoring Clones type 2 | Tuan Tran's Blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/blog/atom.xml" title="Tuan Tran's Blog" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/blog/plugins/prettify/doxy.css"><script type="text/javascript" src="/blog/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">Tuan Tran's Blog</a></h1></div><p class="m-desc">Share to be shared</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/blog/archives/">Archives</a></li><li><span class="dot">●</span><a href="/blog/categories/">Categories</a></li><li><span class="dot">●</span><a href="/blog/tags/">Tags</a></li><li><span class="dot">●</span><a href="/blog/about/">About</a></li><li><span class="dot">●</span><a href="/blog/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="Search for" onfocus="if(this.value=='Search for'){this.value='';}" onblur="if(this.value==''){this.value='Search for';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">[java] Refactoring Clones type 2</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/blog/2019/10/19/refactoring-clones-type-2/">2019-10-19</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/blog/categories/C/">C#</a>&nbsp;&bull;&nbsp;<a href="/blog/categories/Java/">Java</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><p>Removing clones in code maybe is the most difficult type of refactoring action. In this post, I will show you how to refactor a clone type 2 using Functional Interface in Java and delegate in C#</p>
<a id="more"></a>

<h1 id="Type-of-clones"><a href="#Type-of-clones" class="headerlink" title="Type of clones"></a>Type of clones</h1><p>There are 4 type of clones:</p>
<blockquote>
<p><em><strong>Type 1:</strong></em> The codes cloned are identical, except the name of variables, add or remove of comment.</p>
<p><em><strong>Type 2:</strong></em> code fragments are structurally and syntactically identical except for variations in identifiers, literals, types, in addition to Type I differences.</p>
<p><em><strong>Type 3:</strong></em> code fragments are copies with further modifications. Statements can be changed, added, or removed in addition to Type II differences.</p>
<p><em><strong>Type 4:</strong></em> two or more code fragments perform the same computation, but are implemented through different syntactic variants.</p>
<p>S. Bellon, R. Koschke, G. Antoniol, J. Krinke and E. Merlo, Comparison and Evaluation of Clone DetectionTools, Transactions on Software Engineering, 33(9):577-591 (2007)</p>
</blockquote>
<h1 id="Removing-clones"><a href="#Removing-clones" class="headerlink" title="Removing clones"></a>Removing clones</h1><p>Type 1: just remove the second fragment of code and use the first one</p>
<p>Type 3: Based on the function of the code fragment (usually clone codes are in methods), you can perform other refactoring like break the method into smaller ones (<code>extract method</code>), then consider if you can transform type 3 clone into type 2.</p>
<p>Type 4: This one is the most difficult to detect. To eliminate is easy, just use one of them.</p>
<p>I believe to detect this kind of clone, you can inspect the before and after condition of the questioned methods. If they are the same (use the same set of parameters, return the same result, verified by unit tests), then the function of these methods are identical.</p>
<p>For type 2 clone, we will try to transform it to type 1, then introduce the parameter in a new common method, by using a language specific feature called <code>FunctionalInterface</code> in Java and <code>delegate</code> in C#</p>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><p>Consider these lines of code:</p>
<p>public void drawVerticalLine(int length, View currentView){<br>    DrawOptions drawOptions = currentView.getVerticalOptions();<br>    currentView.draw(length, drawOptions);<br>}</p>
<p>public void drawHorizontalLine(int length, View currentView){<br>    DrawOptions drawOptions = currentView.getHorizontalOptions();<br>    currentView.draw(length, drawOptions);<br>}</p>
<p>In 2 method above, both of them draw line to screen, the difference is the <code>drawOptions</code> variable.</p>
<p>To introduce parameter to “transform” this type of clone to type 1, we can do as follow:</p>
<p>/* For JAVA */</p>
<p>public void drawVerticalLine(int length, View currentView){<br>    drawLine(length, currentView, () -&gt; currentView.getVerticalOption());<br>}</p>
<p>public void drawHorizontalLine(int length, View currentView){<br>    drawLine(length, currentView, () -&gt; currentView.getHorizontalOption());<br>}</p>
<p>@FunctionalInterface<br>private interface DrawOption {<br>    int getDrawOption();<br>}</p>
<p>public void drawLine(int length, View currentView, DrawOption drawOption){<br>    int options = drawOption.getDrawOption();<br>    currentView.draw(length, options)<br>}</p>
<p>and for C#</p>
<p>public void drawVerticalLine(int length, View currentView){<br>    drawLine(length, currentView, () =&gt; currentView.getVerticalOption());<br>}</p>
<p>public void drawHorizontalLine(int length, View currentView){<br>    drawLine(length, currentView, () =&gt; currentView.getHorizontalOption());<br>}</p>
<p>public void drawLine(int length, View currentView, Func<int> drawOption){<br>    int option = drawOption();<br>    currentView.draw(length, option);<br>}</p>
<h2 id="Using-tool"><a href="#Using-tool" class="headerlink" title="Using tool"></a>Using tool</h2><p>If you are using Eclipse, <a target="_blank" rel="noopener" href="https://github.com/tsantalis/JDeodorant">JDeodorant</a> plug-in by <a target="_blank" rel="noopener" href="https://users.encs.concordia.ca/~nikolaos/">Associate Professor Nikos Tsantalis</a> can automatically <code>extract</code> the clone into common method for you.</p>
<ol>
<li>Identify the cloned methods</li>
<li>Select the method in Eclipse, right-click and choose <code>Refactor duplicate code...</code></li>
</ol>
<p><img src="https://i.imgur.com/ndLJ8Iz.png"></p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">Author：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">Tuan Tran</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">Link to this article：</span><span class="p-copytight-value"><a href="/blog/2019/10/19/refactoring-clones-type-2/">https://huntertran.github.io/blog/2019/10/19/refactoring-clones-type-2/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">Copyright：</span><span class="p-copytight-value">All rights reserved with<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>agreement. Include the source <a href="https://huntertran.github.io/blog">Tuan Tran's blog</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tags"></i><a href="/blog/tags/clone/">clone</a><a href="/blog/tags/refactor/">refactor</a></span></div><aside id="toc"><div class="toc-title">Table of Contents</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Type-of-clones"><span class="toc-number">1.</span> <span class="toc-text">Type of clones</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Removing-clones"><span class="toc-number">2.</span> <span class="toc-text">Removing clones</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Examples"><span class="toc-number">3.</span> <span class="toc-text">Examples</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Using-tool"><span class="toc-number">3.1.</span> <span class="toc-text">Using tool</span></a></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/blog/2020/07/20/connect-with-google-cloud-compute-engine-virtual-machine-using-putty/">&lt; Connect with Google Cloud Compute Engine (Virtual Machine) using PuTTY</a><a class="next" href="/blog/2019/08/18/vuejs-publish-your-vue-component-to-npmjs-using-vue-cli-3/">[vuejs] - Publish your vue component to npmjs using vue-cli 3 &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'en',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2020 <a href="/blog/." rel="nofollow">Tuan Tran's Blog</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/blog/plugins/prettify/prettify.js"></script><script type="text/javascript" src="/blog/js/search.js"></script><script type="text/javascript" src="/blog/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.1" async></script></body></html>